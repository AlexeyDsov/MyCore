<?php
if ($this->get('isAjax')) {
	$dialogName = $this->get('linker')->getDialogName($infoObject);
	$title = get_class($infoObject).': ';
	$title .= $this->get('nameConverter')->get($infoObject);
	?>
	<script type="text/javascript">
		$(function() {
			var windowHeight = (window.innerHeight - 200);
			$('#<?=$dialogName?>').dialog('option', {
				title: "Info of <?=$this->escape($title)?>",
				width: 600,
				height: windowHeight,
				buttons: {
					<?
					/**
					* @todo убрать здесь эти извращения и передавать в js "json данные", которые будут генерить кнопки
					* сам это сделаю, но несколько позже
					*/
					$count = count($buttonUrlList); $i = 0;
					foreach ($buttonUrlList as $buttonName => $buttonOptions) {
						$isLast = ($i++ >= $count - 1);
						if ($buttonOptions['window']) { ?>
							"<?=$this->escape($buttonName)?>": function() {
								DialogController.spawnByUrl('<?=$buttonOptions['url']?>', '<?=isset($buttonOptions['dialogName']) ? $buttonOptions['dialogName'] : $dialogName?>');
							}<?=!$isLast ? ',' : ''?>
						<? } else { ?>
							"<?=$this->escape($buttonName)?>": function() {
								Application.goUrl('<?=$buttonOptions['url']?>')
							}<?=!$isLast ? ',' : ''?>
						<? }
					} ?>
				}
			});
			var widget = $('#<?=$dialogName?>').dialog('widget');
			var widgetHeader = widget.find('.ui-widget-header');
			if (!widgetHeader.find('.ui-dialog-titlebar-refresh').length) {
				var refreshHtml = '<a href="#" class="ui-dialog-titlebar-refresh ui-corner-all" role="button">'
					+ '<span class="ui-icon ui-icon-refresh">refresh</span>'
					+ '</a>';
				widgetHeader.find('.ui-dialog-titlebar-close').before(refreshHtml);
				widgetHeader.find('.ui-dialog-titlebar-refresh').click(function() {
					DialogController.refresh('<?=$dialogName?>');
					return false;
				});
			}
			if (!widgetHeader.find('.ui-dialog-titlebar-share').length) {
				var shareHtml = '<a href="#" class="ui-dialog-titlebar-share ui-corner-all" role="button">'
					+ '<span class="ui-icon ui-icon-signal-diag">share</span>'
					+ '</a>';
				widgetHeader.find('.ui-dialog-titlebar-close').before(shareHtml);
				widgetHeader.find('.ui-dialog-titlebar-share').click(function() {
					DialogController.shareUrl('<?=$dialogName?>');
					return false;
				});
			}
		});
	</script>
	<?php
}